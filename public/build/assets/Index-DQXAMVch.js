import{o as i,d as r,a as e,p as C,r as b,B as G,C as Q,q as a,c as X,w as Y,b as O,k as ee,s as oe,t as d,u as n,g as S,n as f,F as I,e as te}from"./app-D7AyYUbD.js";import{_ as le}from"./AppLayout--oCV_QjF.js";import{_ as se,a as ne}from"./TSFloatMask-DQG2NVnL.js";import{a as T,s as M}from"./network-FnAx5Vkx.js";import"./TSState-CfcYru-A.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TopSnackbar-DSKYgmwA.js";const ae={class:"bg-slate-500 relative rounded-xl p-2"},de={class:"flex justify-center items-center gap-2 relative"},ce=["for"],ie=["src"],re={__name:"TSScreenImage",props:["init","modalId"],setup(v){const s=v;return(w,g)=>(i(),r("div",ae,[e("div",de,[e("label",{for:s.modalId,class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2 bg-red-600 text-white"},"✕",8,ce),e("img",{src:s.init,class:"object-cover h-screen rounded-xl"},null,8,ie)])]))}};function x(v){let s=document.getElementById(v);s!=null&&(s.checked=!0)}const ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 py-2 bg-slate-50"},_e={class:"py-1 flex justify-between h-14"},pe={class:"flex items-center"},me={class:"input input-bordered flex items-center gap-2 input-sm"},he=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4 opacity-70"},[e("path",{"fill-rule":"evenodd",d:"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z","clip-rule":"evenodd"})],-1),ge={class:"form-control"},be={class:"label cursor-pointer gap-2 px-2"},fe={class:"label-text"},ve={class:"dropdown dropdown-end"},we={tabindex:"0",role:"button",class:"btn m-1 btn-sm"},xe={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box"},ye=["onClick"],ke={class:"dropdown dropdown-end"},Ce={tabindex:"0",role:"button",class:"btn m-1 btn-sm"},Se={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-48"},Ie=["onClick"],Me={class:"dropdown dropdown-end"},$e={tabindex:"0",role:"button",class:"btn m-1 btn-sm"},Be={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-48"},Oe={class:"grid grid-cols-6 gap-2"},Te=e("input",{type:"checkbox",id:"show_model_images",class:"modal-toggle"},null,-1),De={class:"modal",role:"dialog"},je={class:"modal-box w-11/12 max-w-5xl grid grid-cols-7 gap-1"},ze=e("label",{for:"show_model_images",class:"btn btn-sm btn-circle btn-ghost absolute right-0 top-2"},"✕",-1),Ne=["onClick","src"],Ee=e("input",{type:"checkbox",id:"show_full_image",class:"modal-toggle"},null,-1),Ae={class:"modal",role:"dialog"},Le=e("input",{type:"checkbox",id:"confirm_delete_model",class:"modal-toggle"},null,-1),Ve={class:"modal",role:"dialog"},Fe={class:"modal-box w-11/12 max-w-xl"},He=e("label",{for:"confirm_delete_model",class:"btn btn-sm btn-circle btn-ghost absolute right-0 top-2"},"✕",-1),Je={class:"text-lg font-bold"},qe={class:"py-4"},Ke={class:"modal-action flex gap-2"},Pe={for:"confirm_delete_model",class:"btn btn-neutral"},Re=e("input",{type:"checkbox",id:"confirm_download_model",class:"modal-toggle"},null,-1),Ue={class:"modal",role:"dialog"},Ze={class:"modal-box w-11/12 max-w-xl"},We=e("label",{for:"confirm_download_model",class:"btn btn-sm btn-circle btn-ghost absolute right-0 top-2"},"✕",-1),Ge={class:"text-lg font-bold"},Qe={key:0,class:"py-4"},Xe=["href"],Ye={class:"bg-slate-100 p-4 rounded-md"},eo={class:"modal-action flex gap-2"},oo={for:"confirm_download_model",class:"btn btn-error"},ro={__name:"Index",props:{apihost:String,modelIds:Array,failedIds:Array,dlPercent:Object,client_path:String},setup(v){const s=C({engine:"atz",page:1}),w=b({meta:{last_page:1,current_page:1},data:[]}),g=v;var D=g.modelIds;const $=C({});Object.entries(g.dlPercent).forEach(([o,t])=>{$[o]=t});const j=b(null),B=b(null),z=b([]),N=b(null);var E=[];const u=C([]);var A=[];const _=C([]);var c=b({download_url:null,type:null});G(()=>{m(1)}),Q(()=>{W()});async function m(o){s.page=o,u.length>0&&(s.options=JSON.stringify(u)),_.length>0&&(s.types=JSON.stringify(_));let t=await T("get","/api/models",s);if(t==null||t.code!=1){M(t.msg??a("Loading data error"),"error");return}E=t.base_models,A=t.types,w.value=t}function L(o){o.target.checked?(s.engine="lc",_.splice(0,_.length),_.push("checkpoint","lora"),u.splice(0,u.length),u.push("1.5","pre1.5","sdxl","presdxl")):s.engine="atz",m(s.page)}function V(o){z.value=o.images,x("show_model_images")}function y(o){j.value=o,B.value=B.value=="desc"?"asc":"desc",s.sort=o,s.orderby=B.value,m(s.page)}function F(o){N.value=o.thumb,x("show_full_image")}function H(o){s.keyword=o.target.value,m(s.page)}function k(o){return j.value==o?"font-extrabold text-green-500":""}function J(o){return u.indexOf(o)!==-1?"font-extrabold text-green-500":""}function q(o){return _.indexOf(o)!==-1?"font-extrabold text-green-500":""}function K(o){let t=u.indexOf(o);t!==-1?u.splice(t,1):u.push(o),m(s.page)}function P(o){let t=_.indexOf(o);t!==-1?_.splice(t,1):_.push(o),m(s.page)}async function R(o,t){if(o=="crop"){if(D.includes(t.hash)){c.value=t,x("confirm_download_model");return}let l=await T("post","/api/models/download",t);if(l==null||l.code!=1)M(l.msg??a("Server error"),"error");else{c.value=l.data,D.push(c.value.hash),x("confirm_download_model");const p=c.value.download_url,h=document.createElement("a");h.href=p,h.download=c.value.sd_name,h.target="_blank",h.click()}}else o=="delete"&&(c.value=t,x("confirm_delete_model"))}async function U(){let o=await T("delete","/api/models/"+c.value.id);o==null||o.code!=1?M(o?o.msg:a("Delete the model failed"),"error"):(M(a("Successfully deleted"),"success"),m(s.page))}function Z(o,t){return g.modelIds.includes(o)?a("Downloaded"):g.failedIds.includes(o)?a("Retry"):t!=null?t+"%":a("download")}const W=()=>{};return(o,t)=>(i(),X(le,{title:"Model market"},{default:Y(()=>[e("div",ue,[e("div",_e,[O(se,{onHandleJump:m,total:w.value.meta.last_page,cpage:w.value.meta.current_page},null,8,["total","cpage"]),e("div",pe,[e("label",me,[ee(e("input",{type:"text",class:"grow border-none input-xs",placeholder:"Search",onChange:H,"onUpdate:modelValue":t[0]||(t[0]=l=>s.keyword=l)},null,544),[[oe,s.keyword]]),he]),e("div",ge,[e("label",be,[e("span",fe,d(n(a)("Local Models")),1),e("input",{onClick:L,type:"checkbox",class:"checkbox checkbox-sm"})])]),e("div",null,[e("div",ve,[e("div",we,d(n(a)("category")),1),e("ul",xe,[(i(!0),r(I,null,S(n(A),(l,p)=>(i(),r("li",{key:"li_tp_"+p,class:f(q(l))},[e("a",{onClick:h=>P(l)},d(l),9,ye)],2))),128))])])]),e("div",null,[e("div",ke,[e("div",Ce,d(n(a)("filter")),1),e("ul",Se,[(i(!0),r(I,null,S(n(E),(l,p)=>(i(),r("li",{key:"li_bm_"+p,class:f(J(l))},[e("a",{onClick:h=>K(l)},d(l),9,Ie)],2))),128))])])]),e("div",null,[e("div",Me,[e("div",$e,d(n(a)("sort")),1),e("ul",Be,[e("li",null,[e("a",{onClick:t[1]||(t[1]=l=>y("type")),class:f(k("type"))},d(n(a)("category")),3)]),e("li",null,[e("a",{onClick:t[2]||(t[2]=l=>y("rating")),class:f(k("rating"))},d(n(a)("rate")),3)]),e("li",null,[e("a",{onClick:t[3]||(t[3]=l=>y("is_active")),class:f(k("is_active"))},d(n(a)("active")),3)]),e("li",null,[e("a",{onClick:t[4]||(t[4]=l=>y("base_model")),class:f(k("base_model"))},d(n(a)("base model")),3)])])])])])]),e("div",Oe,[(i(!0),r(I,null,S(w.value.data,(l,p)=>(i(),r("div",{key:p},[O(ne,{init:l,mode:"big",onHandleSelectedImage:V,notice:"Type:"+l.type+"<br/>Name:"+l.name+"<br/>Base model:"+l.base_model,export:l.rating,rbg:l.credit,delete:s.engine=="lc"?n(a)("delete"):null,crop:Z(l.hash,$[l.hash]),percent:$[l.hash],onTsComCallback:R},null,8,["init","notice","export","rbg","delete","crop","percent"])]))),128))])]),Te,e("div",De,[e("div",je,[ze,(i(!0),r(I,null,S(z.value,(l,p)=>(i(),r("div",{key:p},[e("img",{onClick:h=>F(l),src:l.thumb,class:"object-cover cursor-pointer w-full h-56"},null,8,Ne)]))),128))])]),Ee,e("div",Ae,[O(re,{init:N.value,"modal-id":"show_full_image",modalId:"show_full_image"},null,8,["init"])]),Le,e("div",Ve,[e("div",Fe,[He,e("h3",Je,d(n(a)("Are you sure to delete the model?")),1),e("p",qe,d(n(a)("This model will be deleted!")),1),e("div",Ke,[e("label",Pe,d(n(a)("cancel")),1),e("label",{for:"confirm_delete_model",class:"btn btn-error",onClick:U},d(n(a)("OK")),1)])])]),Re,e("div",Ue,[e("div",Ze,[We,e("h3",Ge,d(n(a)("Download")),1),n(c)&&n(c).download_url!=null&&n(c).download_url!=""?(i(),r("p",Qe,[e("a",{href:n(c).download_url,target:"_blank"},d(n(c).download_url),9,Xe)])):te("",!0),e("p",null,d(n(a)("download_notice")),1),e("p",Ye,d(g.client_path)+"/"+d(n(c).type=="lora"?"loras":"models"),1),e("div",eo,[e("label",oo,d(n(a)("OK")),1)])])])]),_:1}))}};export{ro as default};
