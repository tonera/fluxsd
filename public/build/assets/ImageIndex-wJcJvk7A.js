import{r as f,y as J,o,d as m,a as e,t as b,F as O,g as A,p as K,j as se,n as U,Q as be,k as I,z as B,u as h,q as d,b as $,f as de,A as xe,e as V,B as we,c as F,w as ne,s as ae,O as ke}from"./app-DEtDzQpV.js";import{_ as ye}from"./AppLayout-BP3DaxNV.js";import{a as X,s as G,g as Ce,c as $e,b as je,e as Se}from"./network-4Yy1av-s.js";import{_ as q}from"./TSSwitch-C3DiupbF.js";import{_ as E}from"./TSSlider-CjJcSQfY.js";import Te from"./ImageNav-MbnZrHij.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TopSnackbar-DBCITb_-.js";const ze={class:"join py-4"},Be={class:"font-semibold grid join-item btn items-center justify-items-center text-center"},Ne={class:"relative join-item"},Me={class:"h-12 bg-white flex border border-gray-200 rounded items-center"},Oe=["value"],Ae=e("svg",{class:"w-4 h-4 mx-2 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),Le=[Ae],Pe=["for"],Ve=e("svg",{class:"w-4 h-4 mx-2 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"18 15 12 9 6 15"})],-1),Ee=[Ve],Je=["id","checked"],Re={class:"absolute rounded shadow bg-white overflow-hidden hidden peer-checked:flex flex-col w-full mt-1 border border-gray-200 z-10"},De=["onClick"],Fe={class:"block p-2 border-transparent border-l-4 group-hover:border-blue-600 group-hover:bg-gray-100"},He={__name:"TSSelector",props:["name","init","label","def"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v,n=f(!1),p=f({name:t.name,val:t.def??""});t.init!=null&&t.init.length>0&&(p.value=t.init[0]);function s(a){try{g("tsComCallback",t.name,a),n.value=!1,p.value=a}catch(i){console.log(i)}}function u(){g("tsComCallback",t.name,""),n.value=!0,p.value={name:t.name,val:""}}return J(()=>t.def,a=>{p.value.val=t.def}),(a,i)=>(o(),m("div",ze,[e("label",Be,b(t.label),1),e("div",Ne,[e("div",Me,[e("input",{onClick:i[0]||(i[0]=r=>n.value=!n.value),value:p.value.val,name:"select",id:"select",class:"peer block min-h-[auto] w-full rounded border-0 bg-transparent px-3 py-[0.32rem] leading-[1.6] outline-none transition-all duration-200 ease-linear focus:placeholder:opacity-100 peer-focus:text-primary data-[twe-input-state-active]:placeholder:opacity-100 motion-reduce:transition-none [&:not([data-twe-input-placeholder-active])]:placeholder:opacity-0",checked:""},null,8,Oe),e("button",{onClick:u,class:"cursor-pointer outline-none focus:outline-none transition-all text-gray-300 hover:text-gray-600"},Le),e("label",{for:"show_more"+t.name,class:"cursor-pointer outline-none focus:outline-none border-l border-gray-200 transition-all text-gray-300 hover:text-gray-600"},Ee,8,Pe)]),e("input",{type:"checkbox",name:"show_morew",id:"show_more"+t.name,class:"hidden peer",checked:n.value},null,8,Je),e("div",Re,[(o(!0),m(O,null,A(t.init,(r,y)=>(o(),m("div",{key:y+"_Sel",class:"cursor-pointer group border-t",onClick:S=>s(r)},[e("a",Fe,b(r.label),1)],8,De))),128))])])]))}},Ge={key:0,class:"inline-flex rounded-md shadow-sm overflow-clip",role:"group"},Ue=e("svg",{class:"w-[20px] h-[20px] fill-[#8e8e8e]",viewBox:"0 0 320 512",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"})],-1),We=[Ue],qe=["onClick"],Ke=e("svg",{class:"w-[20px] h-[20px] fill-[#8e8e8e]",viewBox:"0 0 320 512",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1),Qe=[Ke],Xe={key:1},oe=7,Ye={__name:"Paginate",props:["total","cpage"],emits:["handleJump"],setup(k,{emit:v}){const t=v,g=k;var n=0,p=0;K({start:0,end:0});const s=se(()=>{let i=[];n=g.cpage-Math.floor(oe/2),n=n<1?1:n,p=n+oe,p=p>g.total?g.total:p;for(let r=n;r<=p;r++){let y={label:r,page:r};i.push(y)}return i}),u=se(()=>i=>({"bg-slate-300 hover:bg-slate-500 focus:bg-slate-300 ":g.cpage==i,"bg-neutral-100 hover:bg-slate-500":g.cpage!=i}));function a(i){i>g.total||i<1||t("handleJump",i)}return(i,r)=>k.total>1?(o(),m("div",Ge,[e("button",{type:"button",class:"bg-neutral-100 rounded-l hover:bg-slate-500 inline-block px-3 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-neutral-800 transition duration-150 ease-in-out focus:ring-0 active:bg-neutral-200","data-te-ripple-init":"","data-te-ripple-color":"light",onClick:r[0]||(r[0]=y=>a(parseInt(g.cpage)-1))},We),(o(!0),m(O,null,A(s.value,(y,S)=>(o(),m("button",{type:"button",class:U(["inline-block px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-neutral-800 transition duration-150 ease-in-out focus:ring-0 active:bg-neutral-200",u.value(y.page)]),"data-te-ripple-init":"","data-te-ripple-color":"light",onClick:R=>a(y.page),key:S},b(y.label),11,qe))),128)),e("button",{type:"button",class:"bg-neutral-100 rounded-r hover:bg-slate-500 inline-block px-3 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-neutral-800 transition duration-150 ease-in-out focus:ring-0 active:bg-neutral-200","data-te-ripple-init":"","data-te-ripple-color":"light",onClick:r[1]||(r[1]=y=>a(parseInt(g.cpage)+1))},Qe)])):(o(),m("div",Xe))}},Ze={class:"join py-4"},et={class:"font-semibold grid join-item btn items-center justify-items-center text-center"},tt={class:"relative join-item"},lt={class:"h-12 bg-white flex border border-gray-200 rounded items-center"},st=["src"],nt=["value"],at=e("svg",{class:"w-4 h-4 mx-2 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),ot=[at],it=["for"],rt=e("svg",{class:"w-4 h-4 mx-2 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"18 15 12 9 6 15"})],-1),ct=[rt],dt=["id","checked"],ut={class:"absolute size-[48rem] rounded shadow bg-white overflow-hidden hidden peer-checked:flex flex-col mt-1 border border-gray-200 z-20"},mt={class:"flex justify-end pt-2 pr-4 gap-x-2 items-center"},pt={class:"text-xs",href:"/models",target:"_blank"},_t={class:"p-2 flex justify-between h-16"},gt={class:"menu lg:menu-horizontal z-30 w-40 justify-end"},ht={close:""},vt={class:"w-40 justify-end"},ft=["onClick"],bt={key:0,class:"w-5 h-5 fill-[#0eaf19]",viewBox:"0 0 448 512",xmlns:"http://www.w3.org/2000/svg"},xt=e("path",{d:"M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"},null,-1),wt=[xt],kt={key:1,class:"w-5"},yt={class:"overscroll-auto overflow-auto"},Ct={class:"w-full grid grid-cols-3 lg:grid-cols-4 gap-2 px-2"},$t=["onClick"],jt={class:"absolute z-20 inset-0 bg-gray-900 opacity-0 transition-opacity duration-300 hover:opacity-80 flex items-center justify-center text-white whitespace-pre-wrap overflow-wrap-break-word break-all p-2"},St={class:"absolute inset-0"},Tt=["src"],It={class:"p-2 flex justify-center"},ie={__name:"TSSelectorModel",props:["name","init","label","def","engine","base"],emits:["tsComCallback"],setup(k,{emit:v}){be();const t=k,g=v,n=f(!1),p=f({name:t.name,val:t.def??"",thumb:null}),s=f(1),u=f([]),a=f(0);var i=["1.5","pre1.5","sdxl","presdxl","presd3"];const r=K(i);function y(j){let T=r.indexOf(j);T!==-1?r.splice(T,1):r.push(j),S(1,t.init),console.log(r)}S(1,t.init),J(()=>t.engine,j=>{t.def==null&&(p.value={name:t.name,val:t.def??"",thumb:null}),S(1,t.init),s.value=1}),J(()=>t.base,j=>{r.splice(0,r.length),i=[],t.base=="1.5"?(r.push("1.5","pre1.5"),i.push("1.5","pre1.5")):(r.push("sdxl","presdxl","presd3"),i.push("sdxl","presdxl","presd3")),S(1,t.init)}),J(()=>t.def,j=>{p.value.val=t.def});async function S(j,T){let x=await X("get","/api/models",{page:j,engine:t.engine,types:JSON.stringify([T]),options:JSON.stringify(r),service:1});x.code==1&&(u.value=x.data,a.value=x.meta.last_page,i=x.base_models)}function R(j){s.value=j,S(j,t.init)}function L(j){if(t.engine=="lc"&&j.is_download!=1){G("You must download this model before using it","error");return}try{n.value=!1,p.value.val=j.sd_name,p.value.thumb=j.thumb,g("tsComCallback",t.name,j)}catch(T){console.log(T)}}function N(){g("tsComCallback",t.name,""),n.value=!0,p.value={name:t.name,val:""}}return(j,T)=>(o(),m("div",Ze,[e("label",et,b(t.label),1),e("div",tt,[e("div",lt,[I(e("img",{class:"object-cover w-12 h-12 pr-1",src:p.value.thumb},null,8,st),[[B,p.value.thumb!=null]]),e("input",{onClick:T[0]||(T[0]=x=>n.value=!n.value),value:p.value.val,name:"select",id:"select",class:"peer block min-h-[auto] w-full rounded border-0 bg-transparent px-3 py-[0.32rem] leading-[1.6] outline-none transition-all duration-200 ease-linear focus:placeholder:opacity-100 peer-focus:text-primary data-[twe-input-state-active]:placeholder:opacity-100 motion-reduce:transition-none [&:not([data-twe-input-placeholder-active])]:placeholder:opacity-0",checked:""},null,8,nt),e("button",{onClick:N,class:"cursor-pointer outline-none focus:outline-none transition-all text-gray-300 hover:text-gray-600"},ot),e("label",{for:"show_more"+t.name,class:"cursor-pointer outline-none focus:outline-none border-l border-gray-200 transition-all text-gray-300 hover:text-gray-600"},ct,8,it)]),e("input",{type:"checkbox",name:"show_morew",id:"show_more"+t.name,class:"hidden peer",checked:n.value},null,8,dt),e("div",ut,[e("div",mt,[e("a",pt,b(h(d)("market"))+">>",1),e("button",{class:"btn btn-outline btn-sm",onClick:T[1]||(T[1]=x=>n.value=!1)},b(h(d)("close")),1)]),e("div",_t,[$(Ye,{total:a.value,cpage:s.value,onHandleJump:R},null,8,["total","cpage"]),e("ul",gt,[e("li",null,[e("details",ht,[e("summary",vt,b(h(d)("filter")),1),e("ul",null,[(o(!0),m(O,null,A(h(i),(x,D)=>(o(),m("li",{key:"option_"+D},[e("a",{onClick:W=>y(x)},[r.includes(x)?(o(),m("svg",bt,wt)):(o(),m("div",kt)),de(" "+b(x),1)],8,ft)]))),128))])])])])]),e("div",yt,[e("div",Ct,[(o(!0),m(O,null,A(u.value,(x,D)=>(o(),m("div",{key:"pl_"+D,class:"m-4 relative text-sm font-medium bg-gray-200 hover:bg-gray-300 cursor-pointer"},[e("div",{onClick:W=>L(x),class:"relative h-60"},[e("div",jt,b(x.sd_name)+":"+b(x.base_model),1),e("div",St,[e("img",{class:"object-cover h-full w-full",src:x.thumb},null,8,Tt)])],8,$t),e("div",It,b(x.name),1)]))),128))])])])])]))}},zt={class:"p-1"},Bt=["value","placeholder"],re={__name:"TSTextArea",props:["name","init","label","def"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v,n=f(t.def??""),p=s=>{n.value=s.target.value,g("tsComCallback",t.name,n.value)};return J(()=>t.def,s=>{n.value=t.def}),(s,u)=>(o(),m("div",zt,[e("textarea",{value:n.value,onInput:p,class:"textarea textarea-bordered w-full",placeholder:t.label},`
    `,40,Bt)]))}},Nt={class:"flex gap-2"},Mt=["onClick"],Ot={class:"h-14 w-14 text-center place-items-center grid"},At={class:"text-center font-serif text-gray-800"},Lt={__name:"TSAspect",props:["name","init","label","def"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v,n=f(t.def??0);function p(s,u){g("tsComCallback",t.name,u),n.value=u}return(s,u)=>(o(),m("div",Nt,[(o(!0),m(O,null,A(t.init,(a,i)=>(o(),m("div",{onClick:r=>p(a,i),key:i,class:U(["bg-gray-300 text-center cursor-pointer",n.value==i?"border-solid border-4 border-green-500":""])},[e("div",Ot,[e("div",{class:"bg-white",style:xe({height:a.height/30+"px",width:a.width/30+"px"})},null,4)]),e("div",At,b(a.label),1)],10,Mt))),128))]))}},Pt={key:0,class:"m-1 h-full w-full relative inline-flex items-center p-3 text-sm font-medium text-center text-white bg-gray-200 rounded-lg hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-700"},Vt=["src"],Et=e("svg",{class:"w-[20px] h-[20px] fill-[#dd2222]",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM184 232H328c13.3 0 24 10.7 24 24s-10.7 24-24 24H184c-13.3 0-24-10.7-24-24s10.7-24 24-24z"})],-1),Jt=[Et],Rt={key:1,for:"dropzone-file",class:"m-1 flex h-full w-full flex-col items-center justify-center border-2 border-gray-400 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-200"},Dt={class:"flex flex-col items-center justify-center p-4"},Ft={class:"mb-4 text-sm text-gray-500"},Ht={class:"font-semibold"},Gt=e("p",{class:"text-xs text-gray-500"},"PNG or JPG",-1),Ut={__name:"TSUploadImage",props:["name","desc","def"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=f(t.def),n=v;function p(u){u.target.files[0]!==void 0&&(Ce(u.target.files[0]).then(a=>{g.value=a}).catch(a=>{console.log(a)}),n("tsComCallback",t.name,u.target.files[0]))}function s(){g.value=null,n("tsComCallback",t.name,null)}return J(()=>t.def,u=>{g.value=t.def}),(u,a)=>g.value!=null?(o(),m("div",Pt,[e("img",{src:g.value,class:"object-cover w-36 h-36"},null,8,Vt),e("button",{type:"button",class:"absolute inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white border-2 border-white rounded-full -top-2 -right-2 dark:border-gray-900",onClick:a[0]||(a[0]=i=>s(u.index))},Jt)])):(o(),m("label",Rt,[e("div",Dt,[e("p",Ft,[e("span",Ht,b(t.desc??""),1)]),e("input",{id:"dropzone-file",type:"file",multiple:"",accept:"image/png, image/jpeg",class:"hidden",onInput:a[1]||(a[1]=i=>p(i))},null,32),Gt])]))}},Wt={class:"px-4 py-2 sm:px-6 lg:px-8 lg:py-2 mx-auto flex mb-2 sm:mb-2"},qt={class:"oneline"},Kt=["width","height"],Qt=e("path",{"fill-rule":"evenodd",d:"M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223z"},null,-1),Xt=[Qt],Yt={id:"style-list",class:"flex flex-nowrap overscroll-auto overflow-auto"},Zt=["onClick"],el=["src"],tl={class:"oneline"},ll=["width","height"],sl=e("path",{"fill-rule":"evenodd",d:"M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"},null,-1),nl=[sl],al={__name:"TSImageQueue",props:["name","init","def","tabstyle","moveto"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v,n=f(t.def??0);J(()=>t.moveto,a=>{const i=t.moveto.split("_");console.log(i),i[0]=="next"?u(n.value+1):u(n.value-1)});const p={small:{btnw:30,btnh:70,blockw:"w-16",img:"w-16 h-16 object-cover cursor-pointer",pix:68},normal:{btnw:50,btnh:120,blockw:"w-32",img:"w-32 h-32 object-cover cursor-pointer",pix:132}},s=t.tabstyle=="normal"?p.normal:p.small;async function u(a){let i=parseInt(t.init.length);a=a<0?0:a,a=a>=i?i-1:a;let r=t.init[a];r.index=a,g("tsComCallback",t.name,r),n.value=a;let y=(a-2)*s.pix;document.getElementById("style-list").scrollTo({left:y,behavior:"smooth"})}return(a,i)=>I((o(),m("div",Wt,[e("div",qt,[e("button",{class:"movebutton",type:"button",onClick:i[0]||(i[0]=r=>u(n.value-1))},[(o(),m("svg",{width:h(s).btnw,height:h(s).btnh,fill:"currentColor",class:"bi bi-chevron-compact-left",viewBox:"0 0 16 16"},Xt,8,Kt))])]),e("div",Yt,[(o(!0),m(O,null,A(t.init,(r,y)=>(o(),m("div",{class:"text-center m-1",onClick:S=>u(y),key:"L"+y},[e("div",{class:U(h(s).blockw)},[e("img",{class:U([h(s).img,{"border-solid border-4 border-green-500":y==n.value}]),src:r.thumb},null,10,el)],2)],8,Zt))),128))]),e("div",tl,[e("button",{class:"movebutton",type:"button",onClick:i[1]||(i[1]=r=>u(n.value+1))},[(o(),m("svg",{width:h(s).btnw,height:h(s).btnh,fill:"currentColor",class:"bi bi-chevron-compact-right",viewBox:"0 0 16 16"},nl,8,ll))])])],512)),[[B,t.init!=null&&t.init.length>0]])}},ol={class:"py-2 overflow-scroll"},il=["onClick"],rl={__name:"TSStyle",props:["name","init","def"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v;return(n,p)=>(o(),m("div",ol,[(o(!0),m(O,null,A(t.init,(s,u)=>(o(),m("button",{onClick:a=>g("tsComCallback",t.name,s),key:u,class:"btn btn-sm bg-slate-100 m-1"},b(s),9,il))),128))]))}},cl=["name","checked","onInput"],dl={class:"label-text"},ce={__name:"TSRadio",props:["init","def","name"],emits:["tsComCallback"],setup(k,{emit:v}){const t=k,g=v;function n(p){try{g("tsComCallback",t.name,p.val)}catch(s){console.log(s)}}return(p,s)=>(o(!0),m(O,null,A(t.init,(u,a)=>(o(),m("label",{key:a,class:"label cursor-pointer gap-1"},[e("input",{type:"radio",name:t.name,class:"radio checked:bg-red-500",checked:t.def==u.val,onInput:i=>n(u)},null,40,cl),e("span",dl,b(u.label),1)]))),128))}},ul={},ml={id:"snackbar"};function pl(k,v){return o(),m("div",ml,"Some text some message..")}const _l=Ie(ul,[["render",pl]]),gl={class:"mt-4"},hl={class:"flex-row sm:w-11/12 lg:w-3/4 mx-auto text-center grid justify-items-center"},vl={key:0,class:"grid justify-items-center"},fl=["onClick","disabled"],bl={__name:"OperationButton",props:["init","name","img"],emits:["btnAction"],setup(k,{emit:v}){const t=k,g=v,n=f({act:null,img:null});function p(s){n.value={act:s.act,img:t.img},g("btnAction",n.value)}return(s,u)=>(o(),m("div",gl,[e("div",hl,[t.init!=null?(o(),m("div",vl,[(o(!0),m(O,null,A(t.init,(a,i)=>(o(),m("div",{key:"IB_"+i,class:"items-center inline-flex"},[(o(!0),m(O,null,A(a,(r,y)=>(o(),m("button",{onClick:S=>p(r),key:"BS_"+y,type:"button",class:U([n.value.act==r.act?"bg-red-800 hover:bg-red-900":"bg-gray-600 hover:bg-gray-900","text-white bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-full text-sm px-5 py-2.5 mr-2 mb-2"]),disabled:n.value.act==r.act},b(r.label),11,fl))),128))]))),128))])):V("",!0)])]))}},xl=[],wl=[{label:"Normal",val:"normal"},{label:"Cute",val:"cute"},{label:"Expressive",val:"expressive"},{label:"Original",val:"original"},{label:"Scenic",val:"scenic"}],kl=[{label:"None",val:null},{label:"2X",val:"2x"},{label:"4X",val:"4x"}],P=K({styleList:xl,nijiStyle:wl,upscaleOptions:kl,mjConfig:{denoising_strength:{min:"0",max:"2",def:"1",label:d("Denoising strength"),val:1,step:"1"},seed:{min:"0",max:"4294967295",def:"0",label:d("Seed"),val:"0"},cfg_scale:{min:"0",max:"1000",def:"100",label:d("Scale"),val:"100"},steps:{min:"0.25",max:"1",def:"1",label:d("Steps"),val:"1",step:"0.25"},niji:[{key:"normal",val:d("Normal")},{key:"cute",val:d("Cute")},{key:"expressive",val:d("Expressive")},{key:"original",val:d("Original")},{key:"scenic",val:d("Scenic")}],weird:{min:"0",max:"3000",def:"100",label:d("Weird"),val:"0"},sampler:{label:d("Sampler"),val:""},cref:{min:"0",max:"100",def:"0",label:d("cref"),val:"0"},sref:{min:"0",max:"10",def:"0",label:d("sref"),val:"0"}},sdConfig:{denoising_strength:{min:"0",max:"1",def:"0.4",label:d("Denoising strength"),val:"0.4",step:"0.01"},seed:{min:"-1",max:"4294967295",def:"0",label:d("Seed"),val:"0"},cfg_scale:{min:"0",max:"30",def:"7",label:d("Scale"),val:"7"},steps:{min:"0",max:"50",def:"30",label:d("Steps"),val:"30",step:"1"},weird:{min:"0",max:"0",def:"0",label:d("Weird"),val:"0"},sampler:{label:d("Sampler"),val:"K_DPM_2"}}}),yl={class:"px-5 bg-white grid grid-cols-2"},Cl={id:"left",class:"basis-1/2"},$l={class:"flex gap-2"},jl={class:"flex items-center justify-between gap-2"},Sl={class:"w-16 whitespace-nowrap text-xs text-right"},Tl={class:"badge badge-neutral badge-sm w-10"},Il={class:"flex justify-between p-2"},zl={key:1},Bl={class:"flex items-center gap-2"},Nl={key:0,class:"flex items-center gap-2 w-60"},Ml={class:"text-sm whitespace-nowrap"},Ol={class:"flex"},Al={class:"flex gap-x-4 py-4"},Ll={class:"flex justify-between items-center"},Pl={class:"relative inline-flex items-center cursor-pointer p-2"},Vl={class:"text-sm font-medium text-gray-900 dark:text-gray-300 mr-1"},El={class:"flex justify-start py-4 gap-x-4 items-center"},Jl={class:"w-40 h-40"},Rl={class:"flex flex-col"},Dl={key:0},Fl={class:"flex justify-center p-10"},Hl={id:"right",class:"basis-1/2 bg-gray-100 rounded-xl mx-4"},Gl={class:""},Ul={class:"w-full h-screen"},Wl={class:"relative text-sm font-medium cursor-pointer"},ql={class:"relative"},Kl={class:"flex justify-center pt-52"},Ql={class:"absolute grid z-20 rounded text-accent-content place-content-center"},Xl={key:0,class:"grid justify-center justify-items-center rounded-xl bg-neutral w-52 py-8 bg-opacity-80"},Yl=e("span",{class:"loading loading-dots loading-lg text-error"},null,-1),Zl={class:"text-white flex"},es={class:"w-16 text-center"},ts={class:"absolute inset-0"},ls={key:0,class:""},ss={class:"flex justify-center"},ns=["src"],as={class:"flex justify-center py-5"},os=e("progress",{class:"progress w-56"},null,-1),is=[os],rs={key:1,class:"text-2xl text-stone-700 text-center z-30 pt-20"},cs={id:"my_modal_3",class:"modal bg-gray-900 bg-opacity-80"},ds={class:"h-max w-max"},us=e("form",{method:"dialog"},[e("button",{class:"btn btn-circle btn-ghost absolute right-2 top-2 text-2xl bg-gray-500 hover:bg-white"},"✕")],-1),ms={class:"flex items-center gap-x-9 w-screen justify-evenly"},ps={class:"text-white pb-20"},_s=e("svg",{class:"w-6 h-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1),gs=[_s],hs=["src"],vs={class:"text-white pb-20"},fs=e("svg",{class:"w-6 h-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1),bs=[fs],Ts={__name:"ImageIndex",props:["sdratio","omratio","token","omSamplers","lcSamplers","sdSamplers","engines"],setup(k){const v=k,t=f(!1),g=f(!1),n=f(!1),p=f(),s=f(),u=f(!1),a=f(null),i=f([]),r=f({buttonGroups:[],id:null}),y=f(1),S=f("Unknown"),R=f(""),L=f([]),N=f(0),j=f(null);var T=[],x=3e3,D=1,W="";let Y=localStorage.getItem("aibox_params"),M={};Y!=null?(M=JSON.parse(Y),M.niji!=null&&(g.value=!0),M.model_hash_id=null,M.lora_hash_id=null,M.image_num=M.image_num??1,M.lora_scale=M.lora_scale??.9):M={engine:"lc",model_hash_id:null,lora_hash_id:null,model_name:null,lora_name:null,prompt:null,negative_prompt:null,asp_id:0,niji:null,steps:null,cfg_scale:null,seed:0,face_enhance:!1,upscale:null,width:null,height:null,weird:null,denoising_strength:null,cref:null,sref:null,sampler_name:null,isRandom:!0,image_num:1,lora_scale:.9};const l=K(M);we(()=>{ee(y.value),L.value=Z(l.engine),l.sampler_name=L.value.length>0?L.value[0].val:null});function Z(c){switch(c){case"lc":case"atz":return v.lcSamplers;case"sd":return v.sdSamplers;default:return[]}}async function ee(c){if(T.includes(c)){console.log(c,"requested this page");return}T.push(c);let _=await X("get","/api/images",{page:c});if(_!=null&&_.code==1){let C=_.data;C!==null&&C.forEach(H=>{i.value.push(H)}),C.length>0&&(y.value=c)}}function w(c,_){switch(c){case"isAdvance":t.value=_;break;case"isNiji":g.value=_;break;case"engine":te(_.engine);break;case"style":me(_);break;case"init_img_path":a.value=_;break;case"work_image":ue(_);break;case"model_name":l.model_hash_id=_.hash??null,P.styleList=JSON.parse(_.tags??"[]"),l.model_name=_.sd_name,["sdxl","presdxl"].includes(_.base_model)?j.value="sdxl":j.value="1.5";break;case"lora_name":l.lora_hash_id=_.hash??null,l.lora_name=_.sd_name??null;break;case"sampler_name":l[c]=_.val;break;case"asp_id":l.asp_id=_;let C=p.value[_];l.width=parseInt(C.width*D),l.height=parseInt(C.height*D);break;default:l[c]=_}}function ue(c){if(r.value=c,r.value.index>=i.value.length-3&&ee(y.value+1),c.task!=null){let _=c.task;Object.entries(l).forEach(function([C,H]){C in _&&(l[C]=_[C])})}}function me(c){let _=c;l.prompt.indexOf(_)!==-1||(l.prompt=l.prompt+","+_)}function te(c){switch(l.engine=c,l.model_name=null,l.lora_name=null,l.model_hash_id=null,l.lora_hash_id=null,L.value=Z(l.engine),l.sampler_name=L.value.length>0?L.value[0].val:null,c){case"mj":n.value=!0,p.value=v.omratio,s.value=P.mjConfig,l.image_num=1;break;case"sd":l.image_num=1;case"atz":case"lc":n.value=!1,p.value=v.sdratio,s.value=P.sdConfig;break;default:l.image_num=1,n.value=!1,p.value=v.sdratio,s.value=P.sdConfig}l.cfg_scale=s.value.cfg_scale.def,l.steps=s.value.steps.def,l.seed=s.value.seed.def,l.weird=s.value.weird.def,l.denoising_strength=s.value.denoising_strength.def}te(l.engine),w("asp_id",l.asp_id??0);async function pe(){if(window.Echo.leave("private-channel_task."+W),N.value=0,u.value)return;let c="MK",_=$e(c,l);if(_!==!0){G(_,"error");return}localStorage.setItem("aibox_params",JSON.stringify(l));let C=je(l);C.append("act",c),C.append("job_type","MK");var H={};C.forEach((ve,fe)=>H[fe]=ve),console.log(JSON.stringify(H)),a.value!=null&&C.append("init_img_path",a.value),u.value=!0;let he=v.token,z=await X("post","/api/task",C,{"Content-Type":"multipart/form-data",Authorization:he});z!=null&&z.code==1?(x=parseInt(z.execTime)*100,Q(),W=z.data.task_id,ge(z.data.task_id),N.value=z.data.image_num,z.data!=null&&z.data.init_img!=null&&z.data.init_img!=""&&(a.value=z.data.init_img)):(u.value=!1,G(z.msg??d("Failed to submit AI generation task"),"error"))}function Q(c){x<=-6e3?(u.value==!0&&(u.value=!1,G(d("Over time"),"info")),console.log("over time 60d"),S.value="Unknown"):(x--,S.value=x/100+"秒",setTimeout(function(){Q()},10))}async function _e(c){if(console.log(c),u.value==!0){console.log("Task is running");return}u.value=!0,c.act=="EDIT"?ke.get(route("tools.cropper",{url:c.img.show_url})):(x=1500,Q(),N.value=1,Se(c.act,{init_img_path:c.img.show_url,id:c.img.id,engine:l.engine},le))}function le(c){console.log("ws call back",c,N.value),c.message_type=="standing"?(i.value.unshift(c),r.value=c,x=3e3,N.value=N.value-1,N.value==0&&(u.value=!1)):c.message_type=="ephemeral"?(u.value=!0,x=parseInt(c.execTime??"1")*100):c.message_type=="failed"&&(u.value=!1,x=3e3,G(c.msg??d("Failed to submit AI generation task"),"error"))}const ge=c=>{console.log("listen: channel_task =",c),window.Echo.private("channel_task."+c).listen("TaskMessage",async _=>{le(_.message)})};return(c,_)=>(o(),F(ye,{title:"AI images"},{header:ne(()=>[$(Te,{init:v.engines,def:l.engine,name:"engine",onTsComCallback:w},null,8,["init","def"])]),default:ne(()=>[$(_l),e("div",yl,[e("div",Cl,[e("div",$l,[["lc","atz"].includes(l.engine)?(o(),F(ie,{key:0,name:"model_name",label:h(d)("model"),engine:l.engine,init:"checkpoint",onTsComCallback:w,def:l.model_name},null,8,["label","engine","def"])):V("",!0),e("div",null,[["lc","atz","sd"].includes(l.engine)?(o(),F(ie,{key:0,name:"lora_name",label:h(d)("lora"),engine:l.engine,init:"lora",onTsComCallback:w,base:j.value,def:l.lora_name},null,8,["label","engine","base","def"])):V("",!0),I(e("div",jl,[I(e("input",{type:"range",min:"0",max:"1",step:"0.1","onUpdate:modelValue":_[0]||(_[0]=C=>l.lora_scale=C),class:"range range-xs range-success"},null,512),[[ae,l.lora_scale]]),e("label",Sl,b(h(d)("scale"))+":",1),e("div",Tl,b(l.lora_scale),1)],512),[[B,l.lora_hash_id!=null]])])]),e("div",null,[$(re,{name:"prompt",label:h(d)("prompt"),onTsComCallback:w,def:l.prompt},null,8,["label","def"]),h(P).styleList.length>0?(o(),F(rl,{key:0,name:"style",init:h(P).styleList,onTsComCallback:w},null,8,["init"])):V("",!0)]),$(Lt,{name:"asp_id",label:"Aspect",onTsComCallback:w,init:p.value,def:l.asp_id},null,8,["init","def"]),e("div",Il,[n.value?(o(),F(q,{key:0,name:"isNiji",label:"Niji?",onTsComCallback:w,def:g.value},null,8,["def"])):(o(),m("div",zl)),e("div",Bl,[["lc","atz"].includes(l.engine)?(o(),m("div",Nl,[e("div",Ml,b(h(d)("image num"))+":"+b(l.image_num),1),I(e("input",{type:"range",min:"1",max:"20",value:"1","onUpdate:modelValue":_[1]||(_[1]=C=>l.image_num=C),class:"range range-success range-sm"},null,512),[[ae,l.image_num]])])):V("",!0),$(q,{name:"isRandom",label:h(d)("random seed"),onTsComCallback:w,def:l.isRandom},null,8,["label","def"]),$(q,{name:"isAdvance",label:h(d)("advance"),onTsComCallback:w,def:t.value},null,8,["label","def"])])]),I(e("div",Ol,[$(ce,{init:h(P).nijiStyle,def:l.niji,name:"niji",onTsComCallback:w},null,8,["init","def"])],512),[[B,g.value&&n.value]]),I(e("div",{class:"divider"},b(h(d)("advance")),513),[[B,t.value]]),I(e("div",null,[$(re,{name:"negative_prompt",label:h(d)("neg prompt"),onTsComCallback:w,def:l.negative_prompt},null,8,["label","def"]),e("div",Al,[e("div",null,[$(E,{name:"steps",label:h(d)("steps"),onTsComCallback:w,min:s.value.steps.min.toString,max:s.value.steps.max,def:l.steps,step:s.value.steps.step},null,8,["label","min","max","def","step"])]),e("div",null,[$(E,{name:"cfg_scale",label:h(d)("scale"),onTsComCallback:w,min:s.value.cfg_scale.min,max:s.value.cfg_scale.max,def:l.cfg_scale},null,8,["label","min","max","def"])]),e("div",null,[I($(E,{name:"seed",label:h(d)("seed"),onTsComCallback:w,min:s.value.seed.min,max:s.value.seed.max,def:l.seed},null,8,["label","min","max","def"]),[[B,!l.isRandom]])]),e("div",null,[I($(E,{name:"weird",label:"Weird",onTsComCallback:w,min:s.value.weird.min,max:s.value.weird.max,def:l.weird},null,8,["min","max","def"]),[[B,l.engine=="mj"]])])]),I(e("div",Ll,[$(q,{name:"face_enhance",label:h(d)("Face enhance"),onTsComCallback:w,def:l.face_enhance},null,8,["label","def"]),e("label",Pl,[e("span",Vl,b(h(d)("upscale")),1),$(ce,{init:h(P).upscaleOptions,def:l.upscale,name:"upscale",onTsComCallback:w},null,8,["init","def"])])],512),[[B,["lc","atz"].includes(l.engine)]]),l.engine!="mj"?(o(),F(He,{key:0,name:"sampler_name",label:h(d)("sampler"),init:L.value,onTsComCallback:w,def:l.sampler_name},null,8,["label","init","def"])):V("",!0),e("div",El,[e("div",Jl,[$(Ut,{name:"init_img_path",desc:h(d)("upload a picture"),def:a.value,onTsComCallback:w},null,8,["desc","def"])]),I(e("div",Rl,[$(E,{name:"denoising_strength",label:"Denoising",onTsComCallback:w,min:s.value.denoising_strength.min,max:s.value.denoising_strength.max,def:l.denoising_strength,step:s.value.denoising_strength.step},null,8,["min","max","def","step"]),l.engine=="mj"&&s.value.cref!=null?(o(),m("div",Dl,[$(E,{name:"cref",label:h(d)("cref"),onTsComCallback:w,min:s.value.cref.min,max:s.value.cref.max,def:l.cref,step:s.value.cref.step},null,8,["label","min","max","def","step"]),$(E,{name:"sref",label:h(d)("sref"),onTsComCallback:w,min:s.value.sref.min,max:s.value.sref.max,def:l.sref,step:s.value.sref.step},null,8,["label","min","max","def","step"])])):V("",!0)],512),[[B,a.value!=null]])])],512),[[B,t.value]]),e("div",Fl,[e("button",{onClick:pe,type:"button",class:"text-white bg-gradient-to-r from-green-500 via-green-600 to-green-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 shadow-lg shadow-green-500/50 font-medium rounded-full w-32 text-sm px-5 py-2.5 text-center me-2 mb-2"},b(c.$t("Generate")),1)])]),e("div",Hl,[e("div",Gl,[$(al,{name:"work_image",init:i.value,def:0,tabstyle:"small",onTsComCallback:w,moveto:R.value},null,8,["init","moveto"])]),e("div",Ul,[e("div",Wl,[e("div",ql,[e("div",Kl,[e("div",Ql,[u.value?(o(),m("div",Xl,[Yl,e("label",Zl,[de(" No."+b(N.value)+" "+b(h(d)("estimated"))+":",1),e("div",es,b(S.value),1)])])):V("",!0)])]),e("div",ts,[r.value.show_url!=null?(o(),m("div",ls,[e("div",ss,[e("img",{onclick:"my_modal_3.showModal()",src:r.value.show_url},null,8,ns)]),I(e("div",as,is,512),[[B,u.value]]),$(bl,{init:r.value.buttonGroups,name:"show_image",img:r.value,onBtnAction:_e},null,8,["init","img"])])):(o(),m("div",rs,b(h(d)("image preview area")),1))])])])])]),e("dialog",cs,[e("div",ds,[us,e("div",ms,[e("div",ps,[e("button",{onClick:_[2]||(_[2]=C=>R.value="pre_"+r.value.index),class:"btn btn-circle btn-ghost right-2 top-2 text-2xl bg-gray-500 hover:bg-white bg-opacity-55 hover:text-black"},gs)]),e("img",{class:"h-screen",src:r.value.show_url},null,8,hs),e("div",vs,[e("button",{onClick:_[3]||(_[3]=C=>R.value="next_"+r.value.index),class:"btn btn-circle btn-ghost right-2 top-2 text-2xl bg-gray-500 hover:bg-white bg-opacity-55 hover:text-black"},bs)])])])])])]),_:1}))}};export{Ts as default};
